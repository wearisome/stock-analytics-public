<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weekly Screening Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #f6f4ef;
      --ink: #222222;
      --accent: #0f766e;
      --muted: #6b7280;
      --card: #ffffff;
      --border: #e4e2dd;
    }
    body {
      margin: 0;
      font-family: "Noto Sans JP", "Hiragino Sans", "Yu Gothic", sans-serif;
      background: radial-gradient(circle at top, #fef7e8 0%, #f6f4ef 45%, #eef1f6 100%);
      color: var(--ink);
    }
    header {
      padding: 32px 24px 16px;
      max-width: 1100px;
      margin: 0 auto;
    }
    h1 {
      margin: 0 0 8px;
      font-size: 28px;
      letter-spacing: 0.02em;
    }
    .sub {
      color: var(--muted);
      font-size: 14px;
    }
    main {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 24px 32px;
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 16px;
    }
    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 6px 14px rgba(15, 23, 42, 0.08);
    }
    .card h3 {
      margin: 0 0 8px;
      font-size: 14px;
      color: var(--muted);
      font-weight: 600;
    }
    .card .value {
      font-size: 22px;
      font-weight: 700;
    }
    section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.08);
    }
    section h2 {
      margin: 0 0 16px;
      font-size: 18px;
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .table th,
    .table td {
      padding: 8px 10px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }
    .table th {
      color: var(--muted);
      font-weight: 600;
      background: #f9f7f2;
    }
    .sector-layout {
      display: grid;
      grid-template-columns: 220px 1fr;
      gap: 16px;
      align-items: start;
    }
    .sector-nav {
      position: sticky;
      top: 16px;
      background: #fff7ed;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 12px;
      max-height: 70vh;
      overflow-y: auto;
    }
    .sector-nav a {
      display: block;
      padding: 6px 8px;
      text-decoration: none;
      color: var(--ink);
      border-radius: 8px;
      font-size: 13px;
    }
    .sector-nav a:hover {
      background: #ffedd5;
    }
    .sector-section {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 18px;
      background: #ffffff;
    }
    .sector-section h3 {
      margin: 0 0 8px;
      font-size: 16px;
    }
    .sector-meta {
      color: var(--muted);
      font-size: 12px;
      margin-bottom: 12px;
    }
    .metric-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }
    .metric-tab {
      border: 1px solid var(--border);
      background: #f8fafc;
      color: var(--ink);
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
    }
    .metric-tab.active {
      background: #0f766e;
      color: #fff;
      border-color: #0f766e;
    }
    .heatmap {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
      margin-bottom: 12px;
    }
    .heatmap th,
    .heatmap td {
      padding: 8px;
      text-align: center;
      border: 1px solid var(--border);
    }
    .heatmap td {
      font-weight: 600;
    }
    .heatmap td.highlight {
      outline: 3px solid #f97316;
      outline-offset: -2px;
    }
    .ranking-table tr.selected {
      background: #fff7ed;
    }
    footer {
      text-align: center;
      padding: 20px;
      color: var(--muted);
      font-size: 12px;
    }
    @media (max-width: 640px) {
      h1 { font-size: 22px; }
      section { padding: 16px; }
    }
    @media (max-width: 960px) {
      .sector-layout {
        grid-template-columns: 1fr;
      }
      .sector-nav {
        position: static;
        max-height: none;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Weekly Screening Dashboard</h1>
    <div class="sub">Generated at: 2026-02-25 23:28:27</div>
  </header>
  <main>
    <div class="summary">
      <div class="card">
        <h3>Runs</h3>
        <div class="value">4</div>
      </div>
      <div class="card">
        <h3>Last run</h3>
        <div class="value">2026-02-25</div>
      </div>
      <div class="card">
        <h3>Last candidates</h3>
        <div class="value">0</div>
      </div>
      <div class="card">
        <h3>Last recommendations</h3>
        <div class="value">78</div>
      </div>
    </div>

    <section>
      <h2>Weekly candidates trend</h2>
      <canvas id="candidatesChart" height="120"></canvas>
    </section>

    <section>
      <h2>Return summary</h2>
      <canvas id="returnsChart" height="120"></canvas>
    </section>

    <section>
      <h2>Grade performance (matured -)</h2>
      <table class="table">
        <thead>
          <tr>
            <th>Grade</th>
            <th>Count</th>
            <th>Avg return</th>
            <th>Median return</th>
            <th>Win rate</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan='5'>No matured data</td></tr>
        </tbody>
      </table>
    </section>

    <section>
      <h2>Latest candidates</h2>
      <table class="table">
        <thead>
          <tr>
            <th>Rank</th>
            <th>Grade</th>
            <th>Ticker</th>
            <th>Name</th>
            <th>Sector</th>
            <th>Price</th>
            <th>Target</th>
            <th>Upside</th>
            <th>Score</th>
          </tr>
        </thead>
        <tbody>
          <tr><td colspan='9'>No candidates</td></tr>
        </tbody>
      </table>
    </section>

    <section>
      <h2>Sector dashboards</h2>
      <div class="sector-layout">
        <nav class="sector-nav" id="sectorNav"></nav>
        <div class="sector-content" id="sectorSections"></div>
      </div>
    </section>
  </main>
  <footer>Stock Analytics Dashboard</footer>

  <script>
    const timeseries = [{"date": "2026-02-22", "total_candidates": 10, "total_recommendations": 84, "total_scored_stocks": 2578}, {"date": "2026-02-23", "total_candidates": 10, "total_recommendations": 84, "total_scored_stocks": 2578}, {"date": "2026-02-24", "total_candidates": 10, "total_recommendations": 84, "total_scored_stocks": 2578}, {"date": "2026-02-25", "total_candidates": 0, "total_recommendations": 78, "total_scored_stocks": 1459}];
    const returnSummary = [{"horizon": "4w", "count": 0, "avg": null, "median": null, "win_rate": null}, {"horizon": "12w", "count": 0, "avg": null, "median": null, "win_rate": null}, {"horizon": "26w", "count": 0, "avg": null, "median": null, "win_rate": null}];
    const sectorPages = [{"sector": "その他製品", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 37, "per_median": 18.484288354898336, "pbr_median": 1.2942487993098657, "psr_median": 106.58148700915308}], "rankings": [{"rank": 45, "grade": "C", "ticker": "7990.T", "company_name": "グローブライド", "price": 2340.0, "per": 9.988474836726851, "pbr": 0.8297330954292343, "psr": 40.7329990864547, "final_score": 27.83, "size_bucket": "1兆以上"}, {"rank": 55, "grade": "C", "ticker": "7914.T", "company_name": "共同印刷", "price": 1700.0, "per": 12.763721000075082, "pbr": 0.7289542336804299, "psr": 48.05667640092861, "final_score": 24.84, "size_bucket": "1兆以上"}, {"rank": 61, "grade": "C", "ticker": "7864.T", "company_name": "フジシールインターナショナル", "price": 2764.0, "per": 9.47938816105357, "pbr": 0.946980728051392, "psr": 68.5792407458474, "final_score": 22.67, "size_bucket": "1兆以上"}]}, {"sector": "その他金融業", "buckets": [{"label": "0-500億", "count": 1, "per_median": 13.566076837238962, "pbr_median": 3.0732894670316577, "psr_median": 0.0570643045956676}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 20, "per_median": 13.769564310589164, "pbr_median": 1.0229817784702797, "psr_median": 118.45760249774716}], "rankings": [{"rank": 66, "grade": "C", "ticker": "8793.T", "company_name": "ＮＥＣキャピタルソリューション", "price": 4265.0, "per": 11.863699582753824, "pbr": 0.7335134468579397, "psr": 33.7432853071204, "final_score": 19.71, "size_bucket": "1兆以上"}, {"rank": 69, "grade": "C", "ticker": "8584.T", "company_name": "ジャックス", "price": 4305.0, "per": 8.888934773182466, "pbr": 0.6575938572026919, "psr": 99.6911351283774, "final_score": 17.94, "size_bucket": "1兆以上"}, {"rank": 72, "grade": "C", "ticker": "8425.T", "company_name": "みずほリース", "price": 1505.0, "per": 9.3211941038028, "pbr": 1.020083097799196, "psr": 48.22867434286562, "final_score": 16.45, "size_bucket": "1兆以上"}]}, {"sector": "ガラス・土石製品", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 23, "per_median": 19.49029952348537, "pbr_median": 1.173698227457554, "psr_median": 138.71553763923038}], "rankings": [{"rank": 46, "grade": "C", "ticker": "5233.T", "company_name": "太平洋セメント", "price": 4542.0, "per": 9.849076242518866, "pbr": 0.7941314698460833, "psr": 57.17077448455191, "final_score": 27.49, "size_bucket": "1兆以上"}, {"rank": 50, "grade": "C", "ticker": "5202.T", "company_name": "日本板硝子", "price": 603.0, "per": 6030.0, "pbr": 0.4827730870416657, "psr": 7.052485259676809, "final_score": 26.6, "size_bucket": "1兆以上"}, {"rank": 51, "grade": "C", "ticker": "5301.T", "company_name": "東海カーボン", "price": 1051.0, "per": 11.177283845581195, "pbr": 0.7048586962863805, "psr": 69.4809323552405, "final_score": 26.11, "size_bucket": "1兆以上"}]}, {"sector": "ゴム製品", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 10, "per_median": 14.745620230456069, "pbr_median": 1.140838029467064, "psr_median": 104.20445299525943}], "rankings": [{"rank": 67, "grade": "C", "ticker": "5185.T", "company_name": "フコク", "price": 2018.0, "per": 13.918201255258982, "pbr": 0.7277616173185627, "psr": 31.968922764434435, "final_score": 19.34, "size_bucket": "1兆以上"}, {"rank": 75, "grade": "C", "ticker": "5186.T", "company_name": "ニッタ", "price": 4575.0, "per": 10.756859702334769, "pbr": 0.7897503353202243, "psr": 136.35031164907824, "final_score": 12.95, "size_bucket": "1兆以上"}, {"rank": 77, "grade": "C", "ticker": "5110.T", "company_name": "住友ゴム工業", "price": 2778.5, "per": 14.49626963009339, "pbr": 1.0198444815163512, "psr": 60.50172853247486, "final_score": 8.92, "size_bucket": "1兆以上"}]}, {"sector": "サービス業", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 5, "per_median": 25.450689289501597, "pbr_median": 1.2785388127853885, "psr_median": 42.65294314261285}, {"label": "1兆以上", "count": 115, "per_median": 17.50663129973475, "pbr_median": 2.500917252585155, "psr_median": 109.28465388548244}], "rankings": [{"rank": 2, "grade": "C", "ticker": "4331.T", "company_name": "テイクアンドギヴ・ニーズ", "price": 721.0, "per": 4.03221296348079, "pbr": 0.5932349819396563, "psr": 21.95435240941196, "final_score": 46.37, "size_bucket": "1兆以上"}, {"rank": 8, "grade": "C", "ticker": "2429.T", "company_name": "ワールドホールディングス", "price": 2856.0, "per": 7.402031930333818, "pbr": 1.0273928252295446, "psr": 17.971689304493516, "final_score": 38.62, "size_bucket": "1兆以上"}, {"rank": 10, "grade": "C", "ticker": "4301.T", "company_name": "アミューズ", "price": 2055.0, "per": 7.083764219234746, "pbr": 0.8867952944181954, "psr": 48.04226662127685, "final_score": 36.05, "size_bucket": "1兆以上"}]}, {"sector": "パルプ・紙", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 10, "per_median": 14.771479536704465, "pbr_median": 0.658297733621694, "psr_median": 33.18833525665419}], "rankings": [{"rank": 33, "grade": "C", "ticker": "3863.T", "company_name": "日本製紙", "price": 1283.0, "per": 8.38945922971294, "pbr": 0.3054904466970363, "psr": 12.501466895962968, "final_score": 30.97, "size_bucket": "1兆以上"}, {"rank": 70, "grade": "C", "ticker": "3864.T", "company_name": "三菱製紙", "price": 829.0, "per": 11.016611295681065, "pbr": 0.4404425039236042, "psr": 22.55084475665539, "final_score": 17.86, "size_bucket": "1兆以上"}, {"rank": 73, "grade": "C", "ticker": "3946.T", "company_name": "トーモク", "price": 3620.0, "per": 8.076391057962606, "pbr": 0.6097932800780536, "psr": 26.85006027206814, "final_score": 15.29, "size_bucket": "1兆以上"}]}, {"sector": "不動産業", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 47, "per_median": 13.666555961474591, "pbr_median": 1.5437528272217478, "psr_median": 94.47922724027384}], "rankings": [{"rank": 9, "grade": "C", "ticker": "8860.T", "company_name": "フジ住宅", "price": 891.0, "per": 6.128765992571193, "pbr": 0.5553910644995402, "psr": 22.64319076135161, "final_score": 38.09, "size_bucket": "1兆以上"}, {"rank": 20, "grade": "C", "ticker": "8897.T", "company_name": "ＭＩＲＡＲＴＨホールディングス", "price": 413.0, "per": 6.64735232576855, "pbr": 0.6959516844389921, "psr": 29.775500902542696, "final_score": 34.13, "size_bucket": "1兆以上"}, {"rank": 39, "grade": "C", "ticker": "8881.T", "company_name": "日神グループホールディングス", "price": 817.0, "per": 9.614026829842317, "pbr": 0.5460985370307613, "psr": 43.11764039212127, "final_score": 28.84, "size_bucket": "1兆以上"}]}, {"sector": "保険業", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 1, "per_median": 2180.0, "pbr_median": 14.875469123166155, "psr_median": 112.16025521423472}, {"label": "1兆以上", "count": 10, "per_median": 13.431455126735319, "pbr_median": 1.4708841132117478, "psr_median": 91.4891572045895}], "rankings": [{"rank": 30, "grade": "C", "ticker": "8729.T", "company_name": "ソニーフィナンシャルグループ", "price": 153.6999969482422, "per": 0.8725022533392495, "pbr": 1.5854513631399796, "psr": 36.06709571141041, "final_score": 31.78, "size_bucket": "1兆以上"}, {"rank": 59, "grade": "C", "ticker": "7181.T", "company_name": "かんぽ生命保険", "price": 4886.0, "per": 11.892128705641824, "pbr": 0.4316995018049916, "psr": 66.0945347368084, "final_score": 23.03, "size_bucket": "1兆以上"}, {"rank": 76, "grade": "C", "ticker": "8725.T", "company_name": "ＭＳ＆ＡＤインシュアランスグループホールディングス", "price": 4236.0, "per": 8.782368917546078, "pbr": 1.3563168632835163, "psr": 87.86866237921409, "final_score": 12.79, "size_bucket": "1兆以上"}]}, {"sector": "化学", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 117, "per_median": 18.33153763275358, "pbr_median": 1.1386218907021284, "psr_median": 108.20067227216434}], "rankings": [{"rank": 17, "grade": "C", "ticker": "4611.T", "company_name": "大日本塗料", "price": 1469.0, "per": 5.175815657811289, "pbr": 0.6452290167702445, "psr": 47.858316710997705, "final_score": 34.69, "size_bucket": "1兆以上"}, {"rank": 34, "grade": "C", "ticker": "4246.T", "company_name": "ダイキョーニシカワ", "price": 915.0, "per": 9.023668639053254, "pbr": 0.7193577196910613, "psr": 36.10387768464603, "final_score": 29.92, "size_bucket": "1兆以上"}, {"rank": 43, "grade": "C", "ticker": "7888.T", "company_name": "三光合成", "price": 1060.0, "per": 8.070656311862342, "pbr": 0.9073819804210936, "psr": 34.28849199603651, "final_score": 27.95, "size_bucket": "1兆以上"}]}, {"sector": "医薬品", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 1, "per_median": 758.4905660377358, "pbr_median": 1.3245862315521713, "psr_median": 214.77461133237}, {"label": "1兆以上", "count": 32, "per_median": 22.17716643279614, "pbr_median": 1.4861000060057692, "psr_median": 205.38002430764408}], "rankings": [{"rank": 24, "grade": "C", "ticker": "4569.T", "company_name": "杏林製薬", "price": 1698.0, "per": 10.463396598471776, "pbr": 0.7024191680180031, "psr": 73.20660705549821, "final_score": 33.46, "size_bucket": "1兆以上"}, {"rank": 49, "grade": "C", "ticker": "4553.T", "company_name": "東和薬品", "price": 4380.0, "per": 10.444984976391472, "pbr": 1.1366983584051449, "psr": 79.88166755142836, "final_score": 26.84, "size_bucket": "1兆以上"}, {"rank": 52, "grade": "C", "ticker": "4538.T", "company_name": "扶桑薬品工業", "price": 2423.0, "per": 24230.0, "pbr": 0.5969330011071469, "psr": 33.278952377785686, "final_score": 25.1, "size_bucket": "1兆以上"}]}, {"sector": "卸売業", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 109, "per_median": 14.49736241535411, "pbr_median": 1.1730557283312055, "psr_median": 37.72605536445151}], "rankings": [{"rank": 26, "grade": "C", "ticker": "3151.T", "company_name": "バイタルケーエスケー・ホールディングス", "price": 1400.0, "per": 6.894513936767458, "pbr": 0.6158036325376564, "psr": 11.208704906872544, "final_score": 33.11, "size_bucket": "1兆以上"}, {"rank": 35, "grade": "C", "ticker": "9274.T", "company_name": "ＫＰＰグループホールディングス", "price": 927.0, "per": 8.823529411764707, "pbr": 0.6877497451542206, "psr": 8.947617246296394, "final_score": 29.52, "size_bucket": "1兆以上"}, {"rank": 38, "grade": "C", "ticker": "8091.T", "company_name": "ニチモウ", "price": 2693.0, "per": 7.71721687299404, "pbr": 0.6643579016651626, "psr": 16.055093612389598, "final_score": 28.95, "size_bucket": "1兆以上"}]}, {"sector": "小売業", "buckets": [{"label": "0-500億", "count": 1, "per_median": 50550.0, "pbr_median": 2.434288653181045, "psr_median": 0.0041210973918924}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 1, "per_median": 11.088573360378636, "pbr_median": 4.549847182470142, "psr_median": 20.05300006474572}, {"label": "1兆以上", "count": 112, "per_median": 19.435846198482864, "pbr_median": 1.816235488011011, "psr_median": 66.73184302774379}], "rankings": [{"rank": 11, "grade": "C", "ticker": "8203.T", "company_name": "ＭｒＭａｘＨＤ", "price": 813.0, "per": 9.282941310801553, "pbr": 0.7184492101477195, "psr": 18.616832923419405, "final_score": 36.0, "size_bucket": "1兆以上"}, {"rank": 13, "grade": "C", "ticker": "7516.T", "company_name": "コーナン商事", "price": 4295.0, "per": 8.940652386602553, "pbr": 0.7051013384120329, "psr": 23.561747765870443, "final_score": 35.43, "size_bucket": "1兆以上"}, {"rank": 25, "grade": "C", "ticker": "8167.T", "company_name": "リテールパートナーズ", "price": 1412.0, "per": 10.984907421814222, "pbr": 0.6858434052416505, "psr": 22.670706569558504, "final_score": 33.33, "size_bucket": "1兆以上"}]}, {"sector": "建設業", "buckets": [{"label": "0-500億", "count": 1, "per_median": 46690.0, "pbr_median": 2.04862916477446, "psr_median": 0.0046147033922084}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 72, "per_median": 17.68998373300624, "pbr_median": 1.552494641307332, "psr_median": 80.21929440612418}], "rankings": [{"rank": 42, "grade": "C", "ticker": "1899.T", "company_name": "福田組", "price": 7640.0, "per": 11.395501461726626, "pbr": 0.7044566472400146, "psr": 37.66434426994093, "final_score": 28.05, "size_bucket": "1兆以上"}, {"rank": 54, "grade": "C", "ticker": "1911.T", "company_name": "住友林業", "price": 1664.5, "per": 9.561695772058822, "pbr": 1.0136527978826868, "psr": 44.88189975141518, "final_score": 25.01, "size_bucket": "1兆以上"}, {"rank": 56, "grade": "C", "ticker": "256A.T", "company_name": "飛島ホールディングス", "price": 2492.0, "per": 12.817611356856291, "pbr": 0.904458742054682, "psr": 34.36742021268654, "final_score": 24.05, "size_bucket": "1兆以上"}]}, {"sector": "情報・通信業", "buckets": [{"label": "0-500億", "count": 2, "per_median": 57500.0, "pbr_median": 96.13455493880826, "psr_median": 0.0008299312118758501}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 2, "per_median": 673.4816804143487, "pbr_median": 2.924394289344228, "psr_median": 60.23024241305406}, {"label": "1兆以上", "count": 147, "per_median": 17.822366479787547, "pbr_median": 2.5590618454863683, "psr_median": 177.45330535180955}], "rankings": [{"rank": 3, "grade": "C", "ticker": "9405.T", "company_name": "朝日放送グループホールディングス", "price": 831.0, "per": 6.025232018561486, "pbr": 0.4299464145004214, "psr": 35.78242677282069, "final_score": 45.34, "size_bucket": "1兆以上"}, {"rank": 21, "grade": "C", "ticker": "3696.T", "company_name": "セレス", "price": 1560.0, "per": 7.202881152460984, "pbr": 1.353504013659979, "psr": 60.69718945389532, "final_score": 34.09, "size_bucket": "1兆以上"}, {"rank": 22, "grade": "C", "ticker": "4725.T", "company_name": "ＣＡＣ　Ｈｏｌｄｉｎｇｓ", "price": 1904.0, "per": 9.956596768289495, "pbr": 0.9246196991586642, "psr": 64.39109444761365, "final_score": 33.58, "size_bucket": "1兆以上"}]}, {"sector": "機械", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 111, "per_median": 19.71614144815973, "pbr_median": 1.345151126840425, "psr_median": 122.30282396070152}], "rankings": [{"rank": 15, "grade": "C", "ticker": "6463.T", "company_name": "ＴＰＲ", "price": 1386.0, "per": 8.824091169542243, "pbr": 0.5450673567182698, "psr": 47.84798071529201, "final_score": 34.88, "size_bucket": "1兆以上"}, {"rank": 16, "grade": "C", "ticker": "6302.T", "company_name": "住友重機械工業", "price": 5790.0, "per": 1.0860614609496193, "pbr": 1.020809708376352, "psr": 65.22395563786743, "final_score": 34.75, "size_bucket": "1兆以上"}, {"rank": 28, "grade": "C", "ticker": "6430.T", "company_name": "ダイコク電機", "price": 2648.0, "per": 6.11985486144815, "pbr": 0.7613225161134141, "psr": 70.097266720305, "final_score": 32.06, "size_bucket": "1兆以上"}]}, {"sector": "精密機器", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 28, "per_median": 24.629545417368064, "pbr_median": 1.6126012655073887, "psr_median": 166.8304987717273}], "rankings": [{"rank": 27, "grade": "C", "ticker": "7743.T", "company_name": "シード", "price": 543.0, "per": 11.947194719471948, "pbr": 0.8846601878477343, "psr": 48.961217412538, "final_score": 32.44, "size_bucket": "1兆以上"}, {"rank": 41, "grade": "C", "ticker": "6376.T", "company_name": "日機装", "price": 2444.0, "per": 11.860623119479763, "pbr": 1.020161547840526, "psr": 73.96959409405528, "final_score": 28.51, "size_bucket": "1兆以上"}, {"rank": 48, "grade": "C", "ticker": "7723.T", "company_name": "愛知時計電機", "price": 3220.0, "per": 12.686655372128758, "pbr": 0.9962498309933322, "psr": 86.7353589934193, "final_score": 26.87, "size_bucket": "1兆以上"}]}, {"sector": "繊維製品", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 19, "per_median": 20.756936276205632, "pbr_median": 1.2326144961909795, "psr_median": 86.55783664806663}], "rankings": [{"rank": 14, "grade": "C", "ticker": "3608.T", "company_name": "ＴＳＩホールディングス", "price": 1156.0, "per": 4.81225543252019, "pbr": 0.699775236552481, "psr": 42.829870779077545, "final_score": 35.09, "size_bucket": "1兆以上"}, {"rank": 37, "grade": "C", "ticker": "3109.T", "company_name": "シキボウ", "price": 1146.0, "per": 15.225189318453568, "pbr": 0.409905110186142, "psr": 35.95340197621381, "final_score": 29.18, "size_bucket": "1兆以上"}, {"rank": 58, "grade": "C", "ticker": "3501.T", "company_name": "ＳＵＭＩＮＯＥ", "price": 1382.0, "per": 26.674387183941324, "pbr": 0.5715325508879019, "psr": 17.125954045550245, "final_score": 23.29, "size_bucket": "1兆以上"}]}, {"sector": "証券、商品先物取引業", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 19, "per_median": 16.065309413424714, "pbr_median": 1.249915871047141, "psr_median": 296.4429197666155}], "rankings": [{"rank": 57, "grade": "C", "ticker": "8473.T", "company_name": "ＳＢＩホールディングス", "price": 3187.0, "per": 7.394946283964081, "pbr": 1.1987417537136733, "psr": 107.98430387357824, "final_score": 23.35, "size_bucket": "1兆以上"}, {"rank": 71, "grade": "C", "ticker": "7148.T", "company_name": "ＦＰＧ", "price": 2045.0, "per": 9.455335675975586, "pbr": 3.0633583395249624, "psr": 146.6075118333577, "final_score": 17.46, "size_bucket": "1兆以上"}, {"rank": 74, "grade": "C", "ticker": "8604.T", "company_name": "野村ホールディングス", "price": 1399.5, "per": 11.854141961714385, "pbr": 1.1243528644285123, "psr": 200.95078471716215, "final_score": 13.24, "size_bucket": "1兆以上"}]}, {"sector": "輸送用機器", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 40, "per_median": 14.048795524591943, "pbr_median": 0.9297605476160987, "psr_median": 47.25915294967167}], "rankings": [{"rank": 53, "grade": "C", "ticker": "7201.T", "company_name": "日産自動車", "price": 430.8999938964844, "per": 4308.999938964844, "pbr": 0.3076918639075685, "psr": 12.48190409319981, "final_score": 25.09, "size_bucket": "1兆以上"}, {"rank": 63, "grade": "C", "ticker": "7294.T", "company_name": "ヨロズ", "price": 1070.0, "per": 10700.0, "pbr": 0.4350205354086388, "psr": 12.88676329961478, "final_score": 22.08, "size_bucket": "1兆以上"}, {"rank": 64, "grade": "C", "ticker": "7241.T", "company_name": "フタバ産業", "price": 1148.0, "per": 9.330299089726918, "pbr": 0.7824203505624839, "psr": 14.971382361454902, "final_score": 21.64, "size_bucket": "1兆以上"}]}, {"sector": "金属製品", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 26, "per_median": 14.157072671551397, "pbr_median": 0.8158489421515018, "psr_median": 68.30371721036612}], "rankings": [{"rank": 23, "grade": "C", "ticker": "5989.T", "company_name": "エイチワン", "price": 1445.0, "per": 4.571338184118949, "pbr": 0.5556741250055278, "psr": 20.00988062497508, "final_score": 33.55, "size_bucket": "1兆以上"}, {"rank": 31, "grade": "C", "ticker": "5970.T", "company_name": "ジーテクト", "price": 2047.0, "per": 7.23321554770318, "pbr": 0.4094629754056174, "psr": 27.47459930245536, "final_score": 31.16, "size_bucket": "1兆以上"}, {"rank": 40, "grade": "C", "ticker": "5932.T", "company_name": "三協立山", "price": 698.0, "per": 6980.0, "pbr": 0.2360790316836324, "psr": 6.145931435930775, "final_score": 28.57, "size_bucket": "1兆以上"}]}, {"sector": "鉄鋼", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 20, "per_median": 14.490856514933823, "pbr_median": 0.817873871908167, "psr_median": 71.6172567526799}], "rankings": [{"rank": 18, "grade": "C", "ticker": "5410.T", "company_name": "合同製鐵", "price": 3940.0, "per": 5.17270805708359, "pbr": 0.4109496169511502, "psr": 29.833244661611797, "final_score": 34.63, "size_bucket": "1兆以上"}, {"rank": 19, "grade": "C", "ticker": "5408.T", "company_name": "中山製鋼所", "price": 615.0, "per": 7.947790126647713, "pbr": 0.3107556313720694, "psr": 22.3200511467422, "final_score": 34.18, "size_bucket": "1兆以上"}, {"rank": 60, "grade": "C", "ticker": "5406.T", "company_name": "神戸製鋼所", "price": 2196.0, "per": 6.847734572328417, "pbr": 0.7142878052921701, "psr": 35.29807738554977, "final_score": 22.93, "size_bucket": "1兆以上"}]}, {"sector": "銀行業", "buckets": [{"label": "0-500億", "count": 1, "per_median": 13.200874954429455, "pbr_median": 1.3526476929904383, "psr_median": 0.0037156067237052}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 68, "per_median": 15.815036804530308, "pbr_median": 0.7960777171273508, "psr_median": 253.60661561053195}], "rankings": [{"rank": 32, "grade": "C", "ticker": "8558.T", "company_name": "東和銀行", "price": 1168.0, "per": 6.824024304744099, "pbr": 0.4729259988233536, "psr": 101.69600530317548, "final_score": 31.12, "size_bucket": "1兆以上"}, {"rank": 36, "grade": "C", "ticker": "8713.T", "company_name": "フィデアホールディングス", "price": 2088.0, "per": 9.388489208633093, "pbr": 0.44008972940594, "psr": 79.25454066906201, "final_score": 29.43, "size_bucket": "1兆以上"}, {"rank": 62, "grade": "C", "ticker": "8551.T", "company_name": "北日本銀行", "price": 5050.0, "per": 10.99978218253104, "pbr": 0.4429222731051719, "psr": 159.29206346652, "final_score": 22.14, "size_bucket": "1兆以上"}]}, {"sector": "陸運業", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 37, "per_median": 14.429062909567495, "pbr_median": 1.2203142101082924, "psr_median": 94.21450121374266}], "rankings": [{"rank": 64, "grade": "C", "ticker": "9031.T", "company_name": "西日本鉄道", "price": 3207.0, "per": 8.79184143432848, "pbr": 0.9032825745046168, "psr": 51.48626417903179, "final_score": 21.64, "size_bucket": "1兆以上"}, {"rank": 65, "grade": "C", "ticker": "9048.T", "company_name": "名古屋鉄道", "price": 1833.0, "per": 10.932188226874215, "pbr": 0.7454337607072227, "psr": 51.422317668364585, "final_score": 20.8, "size_bucket": "1兆以上"}, {"rank": 68, "grade": "C", "ticker": "9081.T", "company_name": "神奈川中央交通", "price": 3670.0, "per": 14.305203664003118, "pbr": 0.7109237010339194, "psr": 35.975416480497834, "final_score": 18.24, "size_bucket": "1兆以上"}]}, {"sector": "電気機器", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 3, "per_median": 1730.0, "pbr_median": 0.4504003407848362, "psr_median": 8.166539941418248}, {"label": "1兆以上", "count": 121, "per_median": 22.863073149254667, "pbr_median": 1.4896835163724238, "psr_median": 130.0613794479216}], "rankings": [{"rank": 1, "grade": "C", "ticker": "6699.T", "company_name": "ダイヤモンドエレクトリックホールディングス", "price": 664.0, "per": 2.974377351729081, "pbr": 0.4504003407848362, "psr": 5.918283627041383, "final_score": 49.74, "size_bucket": "2,000-1兆"}, {"rank": 5, "grade": "C", "ticker": "7280.T", "company_name": "ミツバ", "price": 1416.0, "per": 7.041973343942709, "pbr": 0.5882458019979585, "psr": 18.83727553594977, "final_score": 42.01, "size_bucket": "1兆以上"}, {"rank": 12, "grade": "C", "ticker": "6817.T", "company_name": "スミダコーポレーション", "price": 1217.0, "per": 11.150815466373466, "pbr": 0.648882903028529, "psr": 27.334477160292177, "final_score": 35.86, "size_bucket": "1兆以上"}]}, {"sector": "非鉄金属", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 21, "per_median": 30.92279087973383, "pbr_median": 1.6580679594378225, "psr_median": 94.69392168030804}], "rankings": [{"rank": 4, "grade": "C", "ticker": "5852.T", "company_name": "アーレスティ", "price": 909.0, "per": 12.107085775173148, "pbr": 0.4274895032280396, "psr": 13.596885060957794, "final_score": 43.04, "size_bucket": "1兆以上"}, {"rank": 6, "grade": "C", "ticker": "5851.T", "company_name": "リョービ", "price": 2967.0, "per": 8.564995236858058, "pbr": 0.5258862033302582, "psr": 30.53230113952969, "final_score": 41.86, "size_bucket": "1兆以上"}, {"rank": 7, "grade": "C", "ticker": "5757.T", "company_name": "ＣＫサンエツ", "price": 4455.0, "per": 8.691326232002808, "pbr": 0.7135984310124913, "psr": 27.461223277594325, "final_score": 39.87, "size_bucket": "1兆以上"}]}, {"sector": "食料品", "buckets": [{"label": "0-500億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "500-2,000億", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "2,000-1兆", "count": 0, "per_median": null, "pbr_median": null, "psr_median": null}, {"label": "1兆以上", "count": 69, "per_median": 19.88652482269504, "pbr_median": 1.2623184464927004, "psr_median": 72.19402611721269}], "rankings": [{"rank": 29, "grade": "C", "ticker": "2060.T", "company_name": "フィード・ワン", "price": 1255.0, "per": 9.279112754158964, "pbr": 0.8099454851831606, "psr": 16.584575674380417, "final_score": 31.88, "size_bucket": "1兆以上"}, {"rank": 44, "grade": "C", "ticker": "2602.T", "company_name": "日清オイリオグループ", "price": 6060.0, "per": 8.153161031657406, "pbr": 0.90856575099931, "psr": 34.30486924613822, "final_score": 27.92, "size_bucket": "1兆以上"}, {"rank": 47, "grade": "C", "ticker": "2613.T", "company_name": "Ｊ－オイルミルズ", "price": 2050.0, "per": 13.091512867999231, "pbr": 0.6303526161785995, "psr": 30.11490779832865, "final_score": 27.46, "size_bucket": "1兆以上"}]}];
    const sizeBuckets = ["0-500億", "500-2,000億", "2,000-1兆", "1兆以上"];

    const candidateLabels = timeseries.map(item => item.date);
    const candidateCounts = timeseries.map(item => item.total_candidates);
    const recommendationCounts = timeseries.map(item => item.total_recommendations);

    new Chart(document.getElementById('candidatesChart'), {
      type: 'line',
      data: {
        labels: candidateLabels,
        datasets: [
          {
            label: 'Candidates',
            data: candidateCounts,
            borderColor: '#0f766e',
            backgroundColor: 'rgba(15, 118, 110, 0.2)',
            tension: 0.3,
            fill: true
          },
          {
            label: 'Recommendations',
            data: recommendationCounts,
            borderColor: '#ea580c',
            backgroundColor: 'rgba(234, 88, 12, 0.2)',
            tension: 0.3,
            fill: true
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'top' }
        }
      }
    });

    const returnLabels = returnSummary.map(item => item.horizon);
    const avgReturns = returnSummary.map(item => item.avg);
    const winRates = returnSummary.map(item => item.win_rate);

    new Chart(document.getElementById('returnsChart'), {
      type: 'bar',
      data: {
        labels: returnLabels,
        datasets: [
          {
            label: 'Average return (%)',
            data: avgReturns,
            backgroundColor: 'rgba(30, 64, 175, 0.6)'
          },
          {
            label: 'Win rate (%)',
            data: winRates,
            backgroundColor: 'rgba(16, 185, 129, 0.6)'
          }
        ]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'top' }
        }
      }
    });

    const metricLabels = { per: 'PER', pbr: 'PBR', psr: 'PSR' };

    const formatValue = (value) => {
      if (value === null || value === undefined || Number.isNaN(value)) return '-';
      return Number(value).toFixed(2);
    };

    const colorScale = (value, min, max) => {
      if (value === null || value === undefined || Number.isNaN(value)) return '#f1f5f9';
      if (min === null || max === null) return '#e2e8f0';
      if (max === min) return 'hsl(200, 70%, 85%)';
      const ratio = (value - min) / (max - min);
      const hue = 120 - Math.round(80 * ratio);
      return `hsl(${hue}, 70%, 85%)`;
    };

    const slugify = (text, index) => {
      const safe = text
        .toString()
        .trim()
        .replace(/\s+/g, '-')
        .replace(/[^0-9A-Za-z぀-ヿ一-鿿\-]/g, '')
        .toLowerCase();
      return `sector-${index}-${safe || 'item'}`;
    };

    const highlightBucket = (section, bucketLabel) => {
      section.querySelectorAll('.heatmap td').forEach(cell => cell.classList.remove('highlight'));
      if (!bucketLabel) return;
      section.querySelectorAll(`.heatmap td[data-bucket="${bucketLabel}"]`)
        .forEach(cell => cell.classList.add('highlight'));
    };

    const renderSectorPages = () => {
      const nav = document.getElementById('sectorNav');
      const container = document.getElementById('sectorSections');

      if (!sectorPages || sectorPages.length === 0) {
        container.innerHTML = '<div class="sector-section">業種データがありません。</div>';
        return;
      }

      sectorPages.forEach((sectorData, index) => {
        const sectionId = slugify(sectorData.sector, index);

        const navLink = document.createElement('a');
        navLink.href = `#${sectionId}`;
        navLink.textContent = sectorData.sector;
        nav.appendChild(navLink);

        const section = document.createElement('div');
        section.className = 'sector-section';
        section.id = sectionId;

        const header = document.createElement('h3');
        header.textContent = sectorData.sector;
        section.appendChild(header);

        const meta = document.createElement('div');
        meta.className = 'sector-meta';
        meta.textContent = '規模帯ごとの中央値とランキングを表示しています。';
        section.appendChild(meta);

        const tabs = document.createElement('div');
        tabs.className = 'metric-tabs';

        const heatmapWrap = document.createElement('div');

        ['per', 'pbr', 'psr'].forEach((metricKey, metricIndex) => {
          const button = document.createElement('button');
          button.className = 'metric-tab' + (metricIndex === 0 ? ' active' : '');
          button.textContent = metricLabels[metricKey];
          button.dataset.metric = metricKey;
          tabs.appendChild(button);

          const panel = document.createElement('div');
          panel.dataset.metric = metricKey;
          panel.style.display = metricIndex === 0 ? 'block' : 'none';

          const values = sectorData.buckets
            .map(bucket => bucket[`${metricKey}_median`])
            .filter(value => value !== null && value !== undefined && !Number.isNaN(value));
          const minVal = values.length ? Math.min(...values) : null;
          const maxVal = values.length ? Math.max(...values) : null;

          const table = document.createElement('table');
          table.className = 'heatmap';

          const thead = document.createElement('thead');
          const headRow = document.createElement('tr');
          const labelCell = document.createElement('th');
          labelCell.textContent = '規模帯';
          headRow.appendChild(labelCell);
          sizeBuckets.forEach(bucketLabel => {
            const th = document.createElement('th');
            th.textContent = bucketLabel;
            headRow.appendChild(th);
          });
          thead.appendChild(headRow);
          table.appendChild(thead);

          const tbody = document.createElement('tbody');
          const bodyRow = document.createElement('tr');
          const metricCell = document.createElement('td');
          metricCell.textContent = metricLabels[metricKey];
          bodyRow.appendChild(metricCell);

          sizeBuckets.forEach(bucketLabel => {
            const bucket = sectorData.buckets.find(item => item.label === bucketLabel);
            const value = bucket ? bucket[`${metricKey}_median`] : null;
            const count = bucket ? bucket.count : 0;
            const cell = document.createElement('td');
            cell.dataset.bucket = bucketLabel;
            cell.style.background = colorScale(value, minVal, maxVal);
            cell.innerHTML = `<div>${formatValue(value)}</div><div style="font-size:11px;color:#6b7280">n=${count}</div>`;
            bodyRow.appendChild(cell);
          });
          tbody.appendChild(bodyRow);
          table.appendChild(tbody);
          panel.appendChild(table);
          heatmapWrap.appendChild(panel);
        });

        section.appendChild(tabs);
        section.appendChild(heatmapWrap);

        const rankingTitle = document.createElement('h4');
        rankingTitle.textContent = 'Sector ranking';
        rankingTitle.style.margin = '12px 0 8px';
        section.appendChild(rankingTitle);

        const rankingTable = document.createElement('table');
        rankingTable.className = 'table ranking-table';
        const head = document.createElement('thead');
        head.innerHTML = `
          <tr>
            <th>Rank</th>
            <th>Grade</th>
            <th>Ticker</th>
            <th>Name</th>
            <th>Price</th>
            <th>PER</th>
            <th>PBR</th>
            <th>PSR</th>
            <th>Score</th>
            <th>Size</th>
          </tr>`;
        rankingTable.appendChild(head);

        const body = document.createElement('tbody');
        if (!sectorData.rankings || sectorData.rankings.length === 0) {
          const emptyRow = document.createElement('tr');
          emptyRow.innerHTML = '<td colspan="10">No ranking data</td>';
          body.appendChild(emptyRow);
        } else {
          sectorData.rankings.forEach(row => {
            const tr = document.createElement('tr');
            tr.dataset.bucket = row.size_bucket || '';
            tr.innerHTML = `
              <td>${row.rank ?? '-'}</td>
              <td>${row.grade ?? '-'}</td>
              <td>${row.ticker ?? '-'}</td>
              <td>${row.company_name ?? '-'}</td>
              <td>${formatValue(row.price)}</td>
              <td>${formatValue(row.per)}</td>
              <td>${formatValue(row.pbr)}</td>
              <td>${formatValue(row.psr)}</td>
              <td>${formatValue(row.final_score)}</td>
              <td>${row.size_bucket ?? '-'}</td>`;

            tr.addEventListener('click', () => {
              section.querySelectorAll('.ranking-table tr').forEach(r => r.classList.remove('selected'));
              tr.classList.add('selected');
              highlightBucket(section, tr.dataset.bucket);
            });

            body.appendChild(tr);
          });
        }
        rankingTable.appendChild(body);
        section.appendChild(rankingTable);

        tabs.querySelectorAll('.metric-tab').forEach(tab => {
          tab.addEventListener('click', () => {
            tabs.querySelectorAll('.metric-tab').forEach(btn => btn.classList.remove('active'));
            tab.classList.add('active');
            const targetMetric = tab.dataset.metric;
            heatmapWrap.querySelectorAll('div[data-metric]').forEach(panel => {
              panel.style.display = panel.dataset.metric === targetMetric ? 'block' : 'none';
            });
          });
        });

        container.appendChild(section);
      });
    };

    renderSectorPages();
  </script>
</body>
</html>
